
name: test

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

on:
    push:
        branches: [master]
    pull_request:
        branches: ['*']

jobs:

    unit_test:

        strategy:
            fail-fast: false
            matrix:
                python-version: ['3.6', '3.7']

        runs-on: ubuntu-latest

        steps:
        -   uses: actions/checkout@v3
            with:
                fetch-depth: 0

        -   name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v4
            with:
                python-version: ${{ matrix.python-version }}

        -   name: Install dependencies
            run: |
                sudo apt-get update
                python -m pip install --upgrade pip pytest pytest-cov nbval

        -   name: Install
            run: pip install .

        -   name: Test
            run: pytest --cov-report term-missing --cov=atlasreader atlasreader
            
        -   name: Coveralls
            uses: coverallsapp/github-action@v2

        -   name: Test notebooks
            run: |
                for n in `ls notebooks/*ipynb`
                do
                    pytest --nbval-lax -v -s ${n};
                done